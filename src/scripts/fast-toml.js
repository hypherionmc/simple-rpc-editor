"use strict";let e=0;function t(e,t=0){let i;for(;(i=e[t++])&&(" "==i||"\t"==i||"\r"==i););return t-1}function i(e){switch(e[0]){case void 0:return"";case'"':return function(e){let t,i=0,s="";for(;t=e.indexOf("\\",i)+1;){switch(s+=e.slice(i,t-1),e[t]){case"\\":s+="\\";break;case'"':s+='"';break;case"\r":"\n"==e[t+1]&&t++;case"\n":break;case"b":s+="\b";break;case"t":s+="\t";break;case"n":s+="\n";break;case"f":s+="\f";break;case"r":s+="\r";break;case"u":s+=String.fromCharCode(parseInt(e.substr(t+1,4),16)),t+=4;break;case"U":s+=String.fromCharCode(parseInt(e.substr(t+1,8),16)),t+=8;break;default:throw n(e[t])}i=t+1}return s+e.slice(i)}(e.slice(1,-1));case"'":return e.slice(1,-1);case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":case".":let t=e;if("string"==typeof e&&e.length>16)return e;if(-1!=t.indexOf("_")&&(t=t.replace(/_/g,"")),!isNaN(t))return+t;if("-"==e[4]&&"-"==e[7]){let t=new Date(e);if("Invalid Date"!=t.toString())return t}else if(":"==e[2]&&":"==e[5]&&e.length>=7){let t=new Date("0000-01-01T"+e+"Z");if("Invalid Date"!=t.toString())return t}return e}switch(e){case"true":return!0;case"false":return!1;case"nan":case"NaN":return!1;case"null":return null;case"inf":case"+inf":case"Infinity":case"+Infinity":return 1/0;case"-inf":case"-Infinity":return-1/0}return e}function n(t){let i=function(){let t=""[e],i=e;"\n"==t&&i--;let n=1,s="".lastIndexOf("\n",i),r="".indexOf("\n",i);-1==r&&(r=1/0);","!=t&&"\n"!=t||(i=s+1);if(-1==s)return{line:n,column:i+1,position:i,lineContent:"".slice(0,r).trim()};const a=i-s+1,c="".slice(s+1,r).trim();n++;for(;-1!=(s="".lastIndexOf("\n",s-1));)n++;return{line:n,column:a,position:i,lineContent:c}}(),n=String(i.line);return t+="\n"+n+" |  "+i.lineContent+"\n",t+=" ".repeat(n.length+i.column+2)+"^",SyntaxError(t)}function s(t,i=0,r=!1){let a,c=t[i],o=c,f=c,l=!0,h=!1;switch(c){case'"':case"'":if(a=i+1,r&&t[i+1]==c&&t[i+2]==c?(f=c+c+c,a+=2):h=!0,"'"==c)a=t.indexOf(f,a)+1;else for(;a=t.indexOf(f,a)+1;){let e=!0,i=a-1;for(;"\\"==t[--i];)e=!e;if(e)break}if(!a)throw n("Missing "+f+" closer");if(c!=f)a+=2;else if(h){let s=t.indexOf("\n",i+1)+1;if(s&&s<a)throw e=s-2,n("Forbidden end-of-line character in single-line string")}return a;case"(":f=")";break;case"{":f="}";break;case"[":f="]";break;case"<":f=">";break;default:l=!1}let u=0;for(;c=t[++i];)if(c==f){if(0==u)return i+1;u--}else if('"'==c||"'"==c){i=s(t,i,r)-1}else l&&c==o&&u++;throw n("Missing "+f)}function r(e){"string"!=typeof e&&(e=String(e));let t,i,r=-1,a="",c=[];for(;i=e[++r];)switch(i){case".":if(!a)throw n('Unexpected "."');c.push(a),a="";continue;case'"':case"'":if(t=s(e,r),t==r+2)throw n("Empty string key");a+=e.slice(r+1,t-1),r=t-1;continue;default:a+=i}return a&&c.push(a),c}function a(e,t=[]){const i=t.pop();for(let i of t){if("object"!=typeof e){throw n('["'+t.slice(0,t.indexOf(i)+1).join('"].["')+'"]'+" must be an object")}void 0===e[i]&&(e[i]={}),(e=e[i])instanceof Array&&(e=e[e.length-1])}return[e,i]}var c=class{constructor(){this.root={},this.data=this.root,this.inlineScopeList=[]}get isRoot(){return this.data==this.root}set(e,t){let[i,s]=a(this.data,r(e));if("string"==typeof i)throw"Wtf the scope is a string. Please report the bug";if(s in i)throw n(`Re-writing the key '${e}'`);return i[s]=t,t}push(e){if(!(this.data instanceof Array)){if(!this.isRoot)throw n("Missing key");this.data=Object.assign([],this.data),this.root=this.data}return this.data.push(e),this}use(e){return this.data=function(e,t=[]){for(let i of t){if(void 0===e)e=lastData[lastElt]={};else if("object"!=typeof e)throw n('["'+t.slice(0,t.indexOf(i)+1).join('"].["')+'"] must be an object');void 0===e[i]&&(e[i]={}),(e=e[i])instanceof Array&&(e=e[e.length-1])}return e}(this.root,r(e)),this}useArray(e){let[t,i]=a(this.root,r(e));return this.data={},void 0===t[i]&&(t[i]=[]),t[i].push(this.data),this}enter(e,t){return this.inlineScopeList.push(this.data),this.set(e,t),this.data=t,this}enterArray(e){return this.inlineScopeList.push(this.data),this.push(e),this.data=e,this}exit(){return this.data=this.inlineScopeList.pop(),this}};function o(e){"string"!=typeof e&&(e=String(e));const r=new c,a=[];var o=e,f=0;let l,h,u="",d="",p=o[0],g=!0;const w=()=>{if(u=u.replace(/\s*$/,""),g)u&&r.push(i(u));else{if(!u)throw n("Expected key before =");if(!d)throw n("Expected value after =");r.set(u,i(d.replace(/\s*$/,"")))}u="",d="",g=!0};do{switch(p){case" ":g?u&&(u+=p):d&&(d+=p);case"\t":case"\r":continue;case"#":-2==(f=o.indexOf("\n",f+1)-1)&&(f=1/0);continue;case'"':case"'":if(!g&&d){d+=p;continue}let e=o[f+1]==p&&o[f+2]==p;if(l=s(o,f,!0),g){if(u)throw n("Unexpected "+p);u+=e?o.slice(f+2,l-2):o.slice(f,l),f=l}else d=o.slice(f,l),f=l,e&&(d=d.slice(2,-2),"\n"==d[1]?d=d[0]+d.slice(2):"\r"==d[1]&&"\n"==d[2]&&(d=d[0]+d.slice(3)));if(p=o[f=t(o,f)],p&&","!=p&&"\n"!=p&&"#"!=p&&"}"!=p&&"]"!=p&&"="!=p)throw n("Unexpected character after end of string");f--;continue;case"\n":case",":case void 0:w();continue;case"[":case"{":if(h="["==p?"]":"}",g&&!a.length){if(u)throw n("Unexpected "+p);if(l=s(o,f),"["==p&&"["==o[f+1]){if("]"!=o[l-2])throw n("Missing ]]");r.useArray(o.slice(f+2,l-2))}else r.use(o.slice(f+1,l-1));f=l}else if(g){if(u)throw n("Unexpected "+p);r.enterArray("["==p?[]:{}),a.push(h)}else{if(d)throw n("Unexpected "+p);r.enter(u.replace(/\s*$/,""),"["==p?[]:{}),a.push(h),u="",g=!0}continue;case"]":case"}":if(u&&w(),a.pop()!=p)throw n("Unexpected "+p);if(r.exit(),p=o[f=t(o,f+1)],p&&","!=p&&"\n"!=p&&"#"!=p&&"}"!=p&&"]"!=p)throw n("Unexpected character after end of scope");f--;continue;case"=":if(!g)throw n("Unexpected "+p);if(!u)throw n("Missing key before "+p);g=!1;continue;default:g?u+=p:d+=p}}while((p=o[++f])||u);if(a.length)throw n("Missing "+a.pop());return r.root}function f(){let e="";for(let t of arguments)e+="string"==typeof t?t:t[0];return o(e)}f.parse=o,module.exports=f;
